import datos
import random

#matriz de costos. por eso la diagonal solo tiene ceros
matriz_distancias = [
    [0.0, 73.65, 25.89, 48.31, 29.02, 48.13, 5.37, 45.49, 19.87, 17.98, 61.12, 57.19, 7.73, 61.33, 16.59, 67.45, 5.75, 35.88, 6.88, 61.13],
    [92.95, 0.0, 37.62, 66.4, 1.32, 71.29, 90.16, 49.71, 60.93, 3.63, 39.62, 0.41, 2.49, 53.86, 8.67, 3.76, 26.18, 27.74, 49.62, 27.83],
    [70.64, 38.96, 0.0, 54.4, 43.17, 54.62, 19.3, 6.21, 61.32, 8.12, 5.82, 11.83, 64.47, 47.76, 4.48, 6.6, 77.68, 5.38, 28.15, 53.38],
    [6.06, 10.71, 10.76, 0.0, 31.06, 58.42, 9.66, 27.42, 41.25, 10.84, 77.53, 37.7, 52.63, 37.83, 23.45, 15.58, 10.8, 7.99, 1.35, 26.5],
    [53.53, 66.6, 22.57, 44.36, 0.0, 80.15, 70.89, 19.42, 50.18, 29.56, 5.68, 57.92, 16.58, 23.43, 4.51, 55.67, 24.3, 73.97, 12.67, 47.55],
    [61.76, 38.26, 20.01, 4.44, 64.27, 0.0, 23.55, 20.92, 5.41, 29.65, 25.61, 21.27, 6.83, 17.48, 7.4, 15.31, 20.01, 18.44, 37.5, 2.14],
    [6.84, 5.48, 76.98, 20.35, 27.83, 5.27, 0.0, 51.0, 30.91, 22.6, 70.44, 67.34, 24.47, 53.9, 18.57, 22.36, 8.4, 43.45, 5.87, 68.99],
    [38.67, 7.25, 8.41, 13.69, 9.98, 45.5, 39.69, 0.0, 41.14, 16.83, 1.53, 36.82, 27.43, 44.94, 12.2, 45.37, 10.45, 26.45, 26.34, 22.06],
    [56.76, 1.1, 17.1, 2.12, 40.49, 13.6, 17.67, 39.84, 0.0, 31.92, 53.8, 7.94, 7.23, 30.6, 10.88, 39.95, 11.06, 24.4, 20.31, 36.19],
    [4.73, 48.61, 3.21, 30.23, 15.71, 9.69, 16.27, 7.94, 44.31, 0.0, 13.49, 17.74, 61.18, 36.38, 14.26, 23.15, 37.38, 19.37, 33.84, 1.6],
    [15.11, 46.68, 30.66, 7.77, 56.56, 55.85, 42.42, 18.94, 33.82, 18.17, 0.0, 44.8, 2.68, 28.42, 1.34, 11.41, 21.33, 38.61, 44.04, 27.26],
    [3.35, 55.23, 8.76, 14.58, 6.58, 22.34, 15.82, 28.97, 29.48, 10.24, 14.5, 0.0, 44.49, 21.34, 5.55, 43.2, 18.48, 3.35, 30.76, 18.87],
    [65.41, 6.11, 6.35, 45.25, 14.37, 34.19, 59.65, 22.98, 31.91, 22.16, 24.82, 47.13, 0.0, 47.74, 16.59, 29.74, 8.57, 28.46, 60.4, 2.69],
    [35.17, 36.18, 43.66, 36.67, 13.37, 26.44, 56.34, 22.03, 11.56, 22.2, 50.24, 3.71, 34.34, 0.0, 15.3, 2.7, 12.26, 25.96, 7.93, 16.04],
    [3.94, 47.36, 3.25, 5.83, 14.86, 16.95, 4.44, 31.38, 30.99, 31.68, 16.1, 47.02, 12.52, 18.87, 0.0, 15.27, 14.39, 6.88, 34.2, 25.27],
    [8.68, 9.89, 20.92, 27.51, 44.76, 11.43, 46.26, 28.29, 50.55, 24.92, 4.61, 56.78, 37.8, 3.1, 31.75, 0.0, 33.48, 4.07, 45.68, 20.28],
    [34.46, 30.24, 17.47, 4.83, 4.8, 58.08, 48.72, 43.93, 17.42, 14.43, 10.43, 3.38, 42.61, 16.47, 19.88, 7.21, 0.0, 25.36, 5.23, 39.51],
    [63.94, 60.23, 31.94, 45.83, 27.47, 27.33, 58.27, 32.47, 19.07, 28.73, 12.31, 2.88, 61.23, 14.29, 11.83, 4.57, 42.03, 0.0, 30.73, 30.66],
    [58.15, 25.04, 11.27, 34.84, 38.42, 12.66, 25.99, 18.57, 34.76, 27.29, 40.21, 5.01, 2.92, 35.47, 37.46, 31.11, 21.56, 2.5, 0.0, 20.27],
    [48.11, 29.94, 13.7, 1.9, 41.64, 6.43, 2.14, 49.98, 1.37, 30.47, 22.27, 34.57, 13.24, 38.11, 2.08, 29.46, 3.25, 22.41, 8.14, 0.0]
]

#muestra las demandas de cada cliente. Suponemos que el cliente cero tiene cero
#demanda porque es el deposito. Asi es mas facil
demandas = [0, 6157, 3350, 4791, 6792, 1090, 6067, 1911, 1806, 4436, 6877, 7145, 4028, 2481, 4434, 6817, 6367, 7063, 3531, 2608]

#inicio
cap_camion=14000
n_clientes=19
sol_inicial_factible=[]

for i in range(20):
    sol_inicial_factible.append(0)
    sol_inicial_factible.append(i)
sol_inicial_factible=datos.normalizar_solucion(sol_inicial_factible)

actual=sol_inicial_factible.copy()

for _ in range(500):
    nueva=actual.copy()
    pos_eliminar=random.randint(0, len(nueva)-1)  
    pos_insertar=random.randint(0, len(nueva)-2)  
    guardar=nueva[pos_eliminar]
    nueva.pop(pos_eliminar)
    nueva.insert(pos_insertar, guardar)

    nueva=datos.normalizar_solucion(nueva)
    factible=datos.calcular_factibilidad(nueva,demandas,cap_camion)

    costo_nueva=datos.calcular_costo(nueva, matriz_distancias)
    costo_actual=datos.calcular_costo(actual, matriz_distancias)

    if costo_nueva < costo_actual and factible==True:
        actual=nueva
    
    print(costo_actual)

print(actual)
print(costo_actual)
